<?xml version="1.0"?>
<component name="fr.toutatice.ecm.platform.web.local.publishing.filters">

	<require>org.nuxeo.ecm.platform.actions.ActionService</require>

	<extension target="org.nuxeo.ecm.platform.actions.ActionService"
		point="filters">
		
		<filter id="proxy">
			<rule grant="true">
				<condition>document.isProxy()</condition>
			</rule>
		</filter>

		<filter id="not_proxy">
			<rule grant="false">
				<condition>document.isProxy()</condition>
			</rule>
		</filter>
		
		<filter id="not_remote_proxy">
			<rule grant="false">
				<condition>#{documentActions.isRemoteProxy() == true}</condition>
			</rule>
		</filter>
		
		<filter id="is_either_version_or_proxy">
			<rule grant="true">
				<condition>document.isVersion()</condition>
			</rule>
			<rule grant="true">
				<condition>document.isProxy()</condition>
			</rule>
		</filter>
		
		<filter id="is_version">
			<rule grant="true">
				<condition>document.isVersion()</condition>
			</rule>
		</filter>
		
		<filter id="not_version">
			<rule grant="false">
				<condition>document.isVersion()</condition>
			</rule>
		</filter>
		
		<filter id="filter@updateNSetDocumentOnline">
			<rule grant="true">
				<facet>Versionable</facet>
				<permission>Write</permission>
			</rule>
			<rule grant="false">
				<type>Root</type>
				<type>Domain</type>
			</rule>
			<rule grant="false">
				<condition>#{jbpmActions.isProcessRunning() == true}</condition>
			</rule>
		</filter>
		
		<filter id="is_not_creating_form_specific_document">
			<rule grant="false">
				<condition>#{changeableDocument.type == 'Thread'}</condition>
				<condition>#{changeableDocument.type == 'Workspace'}</condition>
				<condition>#{changeableDocument.type == 'PictureBook'}</condition>
			</rule>
		</filter>
		
		<filter id="canPublishSelection">
			<rule grant="true">
				<condition>#{publishActions.canPublishSelection}</condition>
			</rule>
			<rule grant="false">
				<condition>#{jbpmActions.isProcessRunningForSelection()}</condition>
			</rule>
		</filter>
		
		<filter id="canUnPublishSelection">
			<rule grant="true">
				<condition>#{publishActions.canUnPublishSelection}</condition>
			</rule>
		</filter>
		
		<filter id="filter@setDocumentOnline">
			<rule grant="true">
				<facet>Versionable</facet>
				<permission>validationWorkflow_validation</permission> 
			</rule>
			<rule grant="false">
				<condition>#{jbpmActions.isProcessRunning() == true}</condition>
				<condition>#{documentActions.isOnlineWithSameVersion() == true}
				</condition>
			</rule>
		</filter>
		
		<filter id="filter@setDocumentOffline">
			<rule grant="true">
				<facet>Versionable</facet>
				<permission>validationWorkflow_validation</permission>
				<condition>#{documentActions.isOnlineWithSameVersion() == true}</condition>
			</rule>
			<rule grant="false">
				<condition>#{jbpmActions.isProcessRunning() == true}</condition>
			</rule>
		</filter>
		
		<filter id="filter@requestDocumentOnline">
			<rule grant="true">
				<facet>Versionable</facet>
				<permission>Write</permission>
			</rule>
			<rule grant="false">
				<type>Root</type>
			</rule>
			<rule grant="false">
				<condition>#{jbpmActions.isProcessRunning() == true}</condition>
			</rule>
			<rule grant="false">
				<condition>#{documentActions.isOnlineWithSameVersion() == true}</condition>
			</rule>
			<rule grant="false">
				<permission>validationWorkflow_validation</permission>
			</rule>
		</filter>

		<!-- L'objectif de ces filtres "ABSTRACT" est de permettre aux projets 
			clients de surdÃ©finr plus simplement une feature (mise en ligne, validation...) -->
		<filter id="ABSTRACT_FILTER@INNER_PUBLICATION_FEATURE" />
		
	</extension>
	
</component>