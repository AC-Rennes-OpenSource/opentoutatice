tinymce.PluginManager.requireLangPack("ottc_basiclink"),tinymce.PluginManager.add("ottc_basiclink",function(a){function b(b){return function(){var c=a.settings.link_list;"string"==typeof c?tinymce.util.XHR.send({url:c,success:function(a){b(tinymce.util.JSON.parse(a))}}):b(c)}}function c(b){function q(a){var b=i.find("#text");(!b.value()||a.lastControl&&b.value()==a.lastControl.text())&&b.value(a.control.text()),i.find("#href").value(a.control.value())}function r(){var c=[{text:"None",value:""}];return tinymce.each(b,function(b){c.push({text:b.text||b.title,value:a.convertURL(b.value||b.url,"href"),menu:b.menu})}),c}function s(b){return tinymce.each(b,function(b){b.textStyle=function(){return a.formatter.getCssText({inline:"a",classes:[b.value]})}}),b}function t(b,d,e){var f,g=[];return tinymce.each(a.settings[b]||e,function(a){var b={text:a.text||a.title,value:a.value};g.push(b),(c[d]===a.value||!f&&a.selected)&&(f=b)}),f&&!c[d]&&(c[d]=f.value,f.selected=!0),g}function u(b){var c=[];if(tinymce.each(a.dom.select("a:not([href])"),function(a){var d=a.name||a.id;d&&c.push({text:d,value:"#"+d,selected:b.indexOf("#"+d)!=-1})}),c.length)return c.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:c,onselect:q}}function v(){l&&l.value(a.convertURL(this.value(),"href")),!h&&0===c.text.length&&j&&this.parent().parent().find("#text")[0].value(this.value())}function w(a){var b=d.getContent();if(/</.test(b)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(b)||b.indexOf("href=")==-1))return!1;if(a){var e,c=a.childNodes;if(0===c.length)return!1;for(e=c.length-1;e>=0;e--)if(3!=c[e].nodeType)return!1}return!0}var f,g,h,i,j,k,l,m,n,o,p,c={},d=a.selection,e=a.dom;f=d.getNode(),g=e.getParent(f,"a[href]"),j=w(),c.text=h=g?g.innerText||g.textContent:d.getContent({format:"text"}),c.href=g?e.getAttrib(g,"href"):"",c.target=g?e.getAttrib(g,"target"):a.settings.default_link_target||"_blank",c.rel=g?e.getAttrib(g,"rel"):null,c.class=g?e.getAttrib(g,"class"):null,c.title=g?e.getAttrib(g,"title"):"",j&&(k={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){c.text=this.value()}}),b&&(l={type:"listbox",label:"Link list",values:r(),onselect:q,value:a.convertURL(c.href,"href"),onPostRender:function(){l=this}}),a.settings.target_list!==!1&&(n={name:"target",type:"listbox",label:"Target",values:t("target_list","target",[{text:"New tab",value:"_blank"},{text:"Same tab",value:""}])}),a.settings.rel_list&&(m={name:"rel",type:"listbox",label:"Rel",values:t("rel_list","rel",[{text:"None",value:""}])}),a.settings.link_class_list&&(o={name:"class",type:"listbox",label:"Class",values:s(t("link_class_list","class"))}),a.settings.link_title!==!1&&(p={name:"title",type:"textbox",label:"Title",value:c.title}),i=a.windowManager.open({title:"Insert link",data:c,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:v,onkeyup:v},k,p,u(c.href),l,m,n,o],onSubmit:function(b){function i(b,c){var d=a.selection.getRng();window.setTimeout(function(){a.windowManager.confirm(b,function(b){a.selection.setRng(d),c(b)})},0)}function k(){var b={href:f,target:c.target?c.target:null,rel:c.rel?c.rel:null,class:c.class?c.class:null,title:c.title?c.title:null};g?(a.focus(),j&&c.text!=h&&("innerText"in g?g.innerText=c.text:g.textContent=c.text),e.setAttribs(g,b),d.select(g),a.undoManager.add()):j?a.insertContent(e.createHTML("a",b,e.encode(c.text))):a.execCommand("mceInsertLink",!1,b)}var f;return c=tinymce.extend(c,b.data),(f=c.href)?f.indexOf("@")>0&&f.indexOf("//")==-1&&f.indexOf("mailto:")==-1?void i("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(a){a&&(f="mailto:"+f),k()}):/^\s*www\./i.test(f)?void i("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(a){a&&(f="http://"+f),k()}):void k():void a.execCommand("unlink")}})}a.addButton("ottc_basiclink",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onclick:b(c),stateSelector:"a[href]"}),a.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"}),a.addShortcut("Ctrl+K","",b(c)),this.showDialog=c,a.addMenuItem("ottc_basiclink",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onclick:b(c),stateSelector:"a[href]",context:"insert",prependToContext:!0})});