<?xml version="1.0"?>
<component name="fr.toutatice.ecm.platform.web.widgets">

	<require>org.nuxeo.ecm.platform.forms.layout.WebLayoutManager</require>

	<extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager"
		point="widgets">

		<!-- PostalSite, PortalPage widgets -->
		<widget name="title" type="text">
			<labels>
				<label mode="any">Titre</label>
			</labels>
			<translated>false</translated>
			<fields>
				<field>dc:title</field>
			</fields>
			<properties widgetMode="edit">
				<property name="styleClass">dataInputText</property>
				<property name="required">true</property>
				<property name="disabled">false</property>
			</properties>
		</widget>

		<widget name="description" type="textarea">
			<labels>
				<label mode="any">Description</label>
			</labels>
			<translated>false</translated>
			<fields>
				<field>dc:description</field>
			</fields>
			<properties widgetMode="edit">
				<property name="required">false</property>
				<property name="disabled">false</property>
			</properties>
		</widget>

		<widget name="picture" type="file">
			<labels>
				<label mode="any">Visuel</label>
			</labels>
			<translated>false</translated>
			<fields>
				<field>toutatice_navigation:picture</field>
				<field>toutatice_navigation:picture/filename</field>
			</fields>
		</widget>

		<widget name="summary_picture" type="summary_picture_type">
			<labels>
				<label mode="any">Visuel</label>
			</labels>
			<translated>false</translated>
			<fields>
				<field>toutatice_navigation:picture</field>
				<field>toutatice_navigation:picture/filename</field>
			</fields>
		</widget>

		<widget name="content" type="htmltext">
			<labels>
				<label mode="any">Contenu</label>
			</labels>
			<translated>false</translated>
			<fields>
				<field>webp:content</field>
			</fields>
		</widget>

		<widget name="summary_content" type="summary_content_type">
			<labels>
				<label mode="any">Contenu</label>
			</labels>
			<translated>false</translated>
			<fields>
				<field>webp:content</field>
			</fields>
			<properties mode="view">
				<property name="translatedHtml">
					#{noteActions.translateImageLinks(field_0)}
				</property>
				<property name="cssClass">note_content_block</property>
			</properties>
		</widget>

		<!-- Widgets "Mots-clés" -->
		<widget name="toutatice_keywords_widget" type="template">
			<labels>
				<label mode="any">Mots-clés</label>
			</labels>
			<translated>false</translated>
			<fields>
				<field>ttc:keywords</field>
			</fields>
			<properties mode="any">
				<property name="template">
					/widgets/toutatice_keyword_widget.xhtml
				</property>
			</properties>
			<widgetModes>
				<mode value="any">#{nxu:test(currentDocument.type != 'BlogSite' and
					(currentUser.administrator or
					currentNuxeoPrincipal.isMemberOf('Administrators')) ,
					layout.mode,
					'hidden')}
				</mode>
			</widgetModes>
		</widget>

		<widget name="files" type="filesList">
			<labels>
				<label mode="any">Pièces jointes</label>
			</labels>
			<translated>false</translated>
			<fields>
				<field>files:files</field>
			</fields>
			<subWidgets>
				<widget name="sub0" type="file">
					<labels>
						<label mode="any"></label>
					</labels>
					<translated>false</translated>
					<fields>
						<field>file</field>
						<field>filename</field>
					</fields>
				</widget>
			</subWidgets>
		</widget>

	</extension>

	<extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager"
		point="widgettypes">

		<widgetType name="filesList">
			<configuration>
				<title>Files</title>
				<description>
					<p>
						The Files displays an editable list of files, using javascript
						to
						keep the uploaded file path when adding several files in a row.
					</p>
					<p>Items are defined using sub wigdets configuration.</p>
					<p>
						This is actually a template widget type whose template uses a
						&lt;nxu:inputList /&gt; tag in edit or create mode, and a table
						iterating over items in other modes.
					</p>
				</description>
				<categories>
					<category>document</category>
					<category>studio</category>
				</categories>
				<supportedModes>
					<mode>edit</mode>
					<mode>view</mode>
				</supportedModes>
				<acceptingSubWidgets>true</acceptingSubWidgets>
				<fields>
					<list>true</list>
					<complex>false</complex>
					<supportedTypes>
						<type>blob</type>
					</supportedTypes>
					<defaultTypes>
						<type>blob</type>
					</defaultTypes>
				</fields>
				<properties>
					<layouts mode="edit">
						<layout name="list_widget_type_properties_edit">
							<rows>
								<row>
									<widget>required</widget>
								</row>
								<row>
									<widget>diff</widget>
								</row>
							</rows>
							<widget name="required" type="checkbox">
								<labels>
									<label mode="any">Required</label>
								</labels>
								<fields>
									<field>required</field>
								</fields>
							</widget>
							<widget name="diff" type="checkbox">
								<labels>
									<label mode="any">Diff</label>
								</labels>
								<fields>
									<field>diff</field>
								</fields>
							</widget>
						</layout>
					</layouts>
				</properties>
			</configuration>
			<handler-class>
				org.nuxeo.ecm.platform.forms.layout.facelets.plugins.TemplateWidgetTypeHandler
			</handler-class>
			<property name="template">/widgets/files_list_widget_template.xhtml
			</property>
		</widgetType>

		<!-- Widget se basant sur le layout en mode view -->
		<widgetType name="custom_summary_current_document_view">
			<configuration>
				<sinceVersion>5.3.1</sinceVersion>
				<title>View layout</title>
				<categories>
					<category>summary</category>
				</categories>
				<supportedModes>
					<mode>view</mode>
				</supportedModes>
				no configurable properties
			</configuration>
			<handler-class>
				org.nuxeo.ecm.platform.forms.layout.facelets.plugins.TemplateWidgetTypeHandler
			</handler-class>
			<property name="template">
				/widgets/summary/metadata_custom_widget_template.xhtml
			</property>
		</widgetType>

		<widgetType name="summary_content_type">
			<configuration>
				<categories>
					<category>summary</category>
				</categories>
				<supportedModes>
					<mode>view</mode>
				</supportedModes>
			</configuration>
			<handler-class>
				org.nuxeo.ecm.platform.forms.layout.facelets.plugins.TemplateWidgetTypeHandler
			</handler-class>
			<property name="template">
				/widgets/summary/toutatice_summary_content_widget.xhtml
			</property>
		</widgetType>

		<widgetType name="summary_picture_type">
			<configuration>
				<categories>
					<category>summary</category>
				</categories>
				<supportedModes>
					<mode>view</mode>
				</supportedModes>
			</configuration>
			<handler-class>
				org.nuxeo.ecm.platform.forms.layout.facelets.plugins.TemplateWidgetTypeHandler
			</handler-class>
			<property name="template">
				/widgets/summary/toutatice_summary_image_widget.xhtml
			</property>
		</widgetType>

	</extension>

</component>