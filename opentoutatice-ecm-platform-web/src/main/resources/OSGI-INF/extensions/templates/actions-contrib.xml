<?xml version="1.0"?>
<component name="fr.toutatice.ecm.platform.web.templates.actions.contrib">

	<require>fr.toutatice.ecm.platform.web.local.publishing.actions
	</require>

	<extension target="org.nuxeo.ecm.platform.actions.ActionService"
		point="actions">

		<action id="CREATE_DOCUMENT" label="command.create"
			link="#{documentActions.saveDocument}" order="0">
			<category>CREATE_DOCUMENT_FORM</category>
			<filter-id>is_not_creating_workspace</filter-id>
			<filter-id>is_not_creating_portalsite</filter-id>
		</action>

		<action id="CREATE_PORTAL_SITE" label="command.create"
			link="#{documentTemplatesActions.createDocumentFromTemplate}" order="0">
			<category>CREATE_DOCUMENT_FORM</category>
			<filter-id>is_creating_portalsite</filter-id>
		</action>
		
		<action id="CREATE_AND_SET_ONLINE_DOCUMENT">
			<filter-id>portal_site_has_no_template</filter-id>
		</action>


	</extension>

	<extension target="org.nuxeo.ecm.platform.actions.ActionService"
		point="filters">

		<filter id="is_not_creating_portalsite">
			<rule grant="false">
				<condition>#{changeableDocument.type == 'PortalSite'}</condition>
			</rule>
		</filter>

		<filter id="is_creating_portalsite">
			<rule grant="true">
				<condition>#{changeableDocument.type == 'PortalSite'}</condition>
			</rule>
		</filter>
		
		<filter id="portal_site_has_no_template">
			<rule grant="true">
				<condition>#{empty documentTemplatesActions.getTemplates('PortalSite')}</condition>
			</rule>
		</filter>

	</extension>

</component>