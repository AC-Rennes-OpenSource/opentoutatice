<div xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:nxu="http://nuxeo.org/nxweb/util" 
    xmlns:ui="http://java.sun.com/jsf/facelets" id="#{widget.id}">

   <script type="text/javascript">

    jQuery(document).ready(function () { 
				//====================================================
				// Many date (time) fields?

				var nbDateFields = jQuery('.date-picker').size();

				if(nbDateFields == 1){
					jQuery('.date-picker').datepicker({
		                language: "fr",
		                autoclose: true,
		                todayHighlight: true,
		                //startDate: "Beginning of time",
		                clearBtn: true
		            });  
		            
		            jQuery('.time-picker').timepicker({
		                minuteStep: 1,
		                template: 'modal',
		                appendWidgetTo: 'body',
		                showSeconds: false,
		                showMeridian: false,
		                defaultTime: false
		            });
				} else {
		            //====================================================
					// Only case of document with VEVENT schema ...!
		            // Management of dates
		            
		            var $startDateInput = jQuery("input[id*='nxw_pv_event_dtstart_date-picker']")[0];
		            var $endDateInput = jQuery("input[id*='nxw_pv_event_dtend_date-picker']")[0];
		            
		            var startDate = jQuery("input[id*='nxw_pv_event_dtstart_date-picker']").datepicker({
		                language: "fr",
		                autoclose: true,
		                todayHighlight: true,
		                clearBtn: true
		            }).on('changeDate', function(ev) {
		                var endDateValue = endDate.getDate();
		                if(endDateValue != null){
		                    var newDate = new Date(ev.date)
		                    newDate.setDate(newDate.getDate());
		                    endDate.setStartDate(newDate);
		                    if (ev.date.valueOf() &gt; endDateValue.valueOf()) {
		                        startDate.hide();
		                        $endDateInput.focus();
		                    }
		                } else {
		                    var newDate = new Date(ev.date)
		                    newDate.setDate(newDate.getDate());
		                    endDate.setStartDate(newDate);
		                }
		            }).data('datepicker'); 

		            var endDate = jQuery("input[id*='nxw_pv_event_dtend_date-picker']").datepicker({
		                language: "fr",
		                autoclose: true,
		                todayHighlight: true,
		                startDate:  $startDateInput.valueOf(),
		                clearBtn: true,
		            }).on('changeDate', function(ev) {
		                updateEndTime();
		                endDate.hide();
		            }).data('datepicker');

		            //=====================================================================
		            // Mangement of Time

		            var startTime = jQuery("input[id*='nxw_pv_event_dtstart_time-picker']").timepicker({
		                minuteStep: 1,
		                template: 'modal',
		                appendWidgetTo: 'body',
		                showSeconds: false,
		                showMeridian: false,
		                defaultTime: false
		            }).data('timepicker'); 

		            var endTime = jQuery("input[id*='nxw_pv_event_dtend_time-picker']").timepicker({
		                minuteStep: 1,
		                template: 'modal',
		                appendWidgetTo: 'body',
		                showSeconds: false,
		                showMeridian: false,
		                defaultTime: false
		            }).data('timepicker'); 

		            var $startTimeInput = jQuery("input[id*='nxw_pv_event_dtstart_time-picker']")[0];
		            var $endTimeInput = jQuery("input[id*='nxw_pv_event_dtend_time-picker']")[0];

		            function updateEndTime(){
		                if(startDate.getDate().valueOf() == endDate.getDate().valueOf()){
		                    if((endTime.hour &lt; startTime.hour) || ((endTime.hour == startTime.hour) &amp;&amp; (endTime.minute &lt; startTime.minute))){
		                        endTime.setTime(startTime.hour + ":" + (startTime.minute + 1));
		                        $endTimeInput.focus();
		                    }
		                }
		            }

		            jQuery("input[id*='nxw_pv_event_dtstart_time-picker']").change(function(){
		                updateEndTime();
		            });

		            jQuery("input[id*='nxw_pv_event_dtend_time-picker']").change(function(){
		                updateEndTime();
		            });
		            
		            //=======================================================================
		            //Management of fullDay

		            function disableTimeFields(){
		                jQuery(".time-picker").attr("disabled", "disabled");
		            }

		            var $allDay = jQuery("[id*='pv_event_all_day']");
		            if(typeof($allDay) !== "undefined"){

		                if($allDay.is(':checked')){
		                    disableTimeFields();
		                }

		                $allDay.click(function(){
		                    
		                    if($allDay.is(':checked')){
		                        disableTimeFields()
		                    } else {
		                        jQuery(".time-picker").removeAttr("disabled");
		                    }

		                });
		            }
				}
            
});

   </script>    

    <div class="row">
        
        <div class="control-group">
            <div class="controls">
                <div class="col-sm-6">

                    <div class="input-group">
                        <h:outputLabel for="#{widget.id}_date-picker" class="input-group-addon"><i class="glyphicons calendar"></i>
                        </h:outputLabel>
                        <h:inputText id="#{widget.id}_date-picker"  class="date-picker form-control" value="#{field_0}" required="#{widget.properties.required}"/>
                    </div>
                    <h:message styleClass="errorMessage" for="#{widget.id}_date-picker" id="#{widget.id}_message" />
                    
                </div>
                
                <c:if test="#{not empty field_1}">
	                <div class="col-sm-2">
	                    <label class="control-label">#{messages['toutatice.label.time']}</label>
	                </div>
	                <div class="col-sm-4">
	                <!-- add btn class after input-group-addon to enable time widget -->
	                <div class="input-group">
	                        <h:outputLabel for="#{widget.id}_time-picker" class="input-group-addon"><i class="glyphicons halflings time"></i>
	                        </h:outputLabel>
	                        <h:inputText id="#{widget.id}_time-picker" class="time-picker form-control" value="#{field_1}"/>
	                    </div>
	
	                </div>
                </c:if>
                
            </div>
        </div>
    
    </div>
    <p/>

</div>